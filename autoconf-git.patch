commit a11cc13e77e96cf40b6060dd8384a00ff110b846
Author: Ralf Wildenhues <Ralf.Wildenhues@gmx.de>
Date:   Wed Aug 4 20:31:06 2010 +0200

    Fix AC_LANG_SOURCE and AC_LANG_PROGRAM tests.
    
    * tests/compile.at (AC_LANG_SOURCE example)
    (AC_LANG_PROGRAM example): Fix broken sed script for
    extracting the interesting part of the conftest.c file.
    Fixes test failure on Haiku.
    * THANKS: Update.
    Report by Scott McCreary.
    
    Signed-off-by: Ralf Wildenhues <Ralf.Wildenhues@gmx.de>

diff --git a/THANKS b/THANKS
index a621844..fc5a9b7 100644
--- a/THANKS
+++ b/THANKS
@@ -350,6 +350,7 @@ Sam Varshavchik             mrsam@courier-mta.com
 Sander Niemeijer            niemeijer@science-and-technology.nl
 santil√≠n                    listas@gestiong.org
 Scott Bambrough             scottb@corelcomputer.com
+Scott McCreary              scottmc2@gmail.com
 Scott Stanton               stanton@scriptics.com
 Sebastian Freundt           hroptatyr@gna.org
 Sergey Poznyakoff           ?
diff --git a/tests/compile.at b/tests/compile.at
index 028f456..6a1092b 100644
--- a/tests/compile.at
+++ b/tests/compile.at
@@ -190,12 +190,11 @@ gcc -E -dD conftest.c || AS_EXIT([77])
 AT_CHECK_AUTOCONF
 AT_CHECK_CONFIGURE([], [], [stdout])
 # Taken from autoconf.texi:Generating Sources.
-# Note that the output may contain more than one line matching
+# Note that the output may contain more defines and lines matching
 #   # 1 "conftest.c"
-# so delete everything until the last one.
-AT_CHECK([sed  '1,/# 1 "conftest\.c"/d' stdout], [],
-[[
-#define PACKAGE_NAME "Hello"
+# so delete everything before the interesting output.
+AT_CHECK([sed -n '/#define PACKAGE/,$p' stdout], [],
+[[#define PACKAGE_NAME "Hello"
 #define PACKAGE_TARNAME "hello"
 #define PACKAGE_VERSION "1.0"
 #define PACKAGE_STRING "Hello 1.0"
@@ -236,12 +235,11 @@ gcc -E -dD conftest.c || AS_EXIT([77])
 AT_CHECK_AUTOCONF
 AT_CHECK_CONFIGURE([], [], [stdout])
 # Taken from autoconf.texi:Generating Sources.
-# Note that the output may contain more than one line matching
+# Note that the output may contain more defines and lines matching
 #   # 1 "conftest.c"
-# so delete everything until the last one.
-AT_CHECK([sed  '1,/# 1 "conftest\.c"/d' stdout], [],
-[[
-#define PACKAGE_NAME "Hello"
+# so delete everything before the interesting output.
+AT_CHECK([sed -n '/#define PACKAGE/,$p' stdout], [],
+[[#define PACKAGE_NAME "Hello"
 #define PACKAGE_TARNAME "hello"
 #define PACKAGE_VERSION "1.0"
 #define PACKAGE_STRING "Hello 1.0"
commit 64000cf1f891b8c64b9ad12f7b0f06075ba403b7
Author: Eric Blake <eblake@redhat.com>
Date:   Sat Aug 14 13:17:04 2010 -0600

    AC_INIT: allow bugreport to contain '?'
    
    * lib/autoconf/general.m4 (_AC_INIT_PACKAGE): Relax check.
    * tests/base.at (AC_INIT with unusual version strings): Enhance
    test.
    * doc/autoconf.texi (Initializing configure): Document this.
    * NEWS: Likewise.
    * THANKS: Update.
    Reported by Yavor Doganov and others.
    
    Signed-off-by: Eric Blake <eblake@redhat.com>

diff --git a/NEWS b/NEWS
index d7c74df..3c0aed3 100644
--- a/NEWS
+++ b/NEWS
@@ -5,6 +5,9 @@ GNU Autoconf NEWS - User visible changes.
 ** AT_BANNER() with empty argument will cause visual separation from previous
    test category.
 
+** AC_INIT again allows URLs with '?' for its BUG-REPORT argument.
+   Regression introduced in 2.66.
+
 
 * Major changes in Autoconf 2.67 (2010-07-21) [stable]
   Released by Eric Blake, based on git versions 2.66.*.
diff --git a/THANKS b/THANKS
index e26eb88..3b23589 100644
--- a/THANKS
+++ b/THANKS
@@ -408,6 +408,7 @@ Werner Lemberg              wl@gnu.org
 Wilfredo Sanchez            wsanchez@apple.com
 William Pursell             bill.pursell@gmail.com
 Wolfgang Mueller            Wolfgang.Mueller@cui.unige.ch
+Yavor Doganov               yavor@gnu.org
 Yury Puhalsky               pooh@cryptopro.ru
 Zack Weinberg               zack@codesourcery.com
 ?                           Seanster@Seanster.com
diff --git a/doc/autoconf.texi b/doc/autoconf.texi
index 0f04b10..05705f2 100644
--- a/doc/autoconf.texi
+++ b/doc/autoconf.texi
@@ -1888,7 +1888,8 @@ Exactly @samp{@var{package} @var{version}}.
 @acindex{PACKAGE_BUGREPORT}
 @ovindex PACKAGE_BUGREPORT
 @cvindex PACKAGE_BUGREPORT
-Exactly @var{bug-report}, if one was provided.
+Exactly @var{bug-report}, if one was provided.  Typically an email
+address, or URL to a bug management web page.
 
 @item @code{AC_PACKAGE_URL}, @code{PACKAGE_URL}
 @acindex{PACKAGE_URL}
diff --git a/lib/autoconf/general.m4 b/lib/autoconf/general.m4
index 8e9c8cf..99cc326 100644
--- a/lib/autoconf/general.m4
+++ b/lib/autoconf/general.m4
@@ -239,7 +239,7 @@ m4_define([_AC_INIT_LITERAL],
 m4_define([_AC_INIT_PACKAGE],
 [_AC_INIT_LITERAL([$1])
 _AC_INIT_LITERAL([$2])
-AS_LITERAL_IF([$3], [],  [m4_warn([syntax], [AC_INIT: not a literal: $3])])
+_AC_INIT_LITERAL([$3])
 m4_ifndef([AC_PACKAGE_NAME],
 	  [m4_define([AC_PACKAGE_NAME],     [$1])])
 m4_ifndef([AC_PACKAGE_TARNAME],
diff --git a/tests/base.at b/tests/base.at
index 3fcc096..4ba0140 100644
--- a/tests/base.at
+++ b/tests/base.at
@@ -227,7 +227,7 @@ AT_SETUP([AC_INIT with unusual version strings])
 
 AT_DATA([configure.ac],
 [[AC_INIT([GNU String++ with  spaces (foo)],
-	  [2.48++  (2010-07-03)], [http://clisp.cons.org/], [clisp])
+	  [2.48++  (2010-07-03)], [[http://example.com/?a=b&c=d#e]], [clisp])
 AC_OUTPUT
 ]])
 
@@ -239,18 +239,21 @@ fi
 
 AT_CHECK_AUTOCONF([-Werror])
 AT_CHECK_CONFIGURE([-q])
-AT_CHECK_CONFIGURE([--help])
+AT_CHECK_CONFIGURE([--help], [], [stdout])
+AT_CHECK([[$FGREP 'com/?a=b&c=d#e' stdout]], [], [ignore])
 AT_CHECK_CONFIGURE([--version], [], [stdout])
 AT_CHECK([$FGREP 'GNU String++ with  spaces (foo)' stdout], [], [ignore])
 AT_CHECK([$FGREP '2.48++  (2010-07-03)' stdout], [], [ignore])
 
+AT_CHECK([./config.status --help], [], [stdout])
+AT_CHECK([[$FGREP 'com/?a=b&c=d#e' stdout]], [], [ignore])
 AT_CHECK([./config.status --version], [], [stdout])
 AT_CHECK([$FGREP 'GNU String++ with  spaces (foo)' stdout], [], [ignore])
 AT_CHECK([$FGREP '2.48++  (2010-07-03)' stdout], [], [ignore])
 
 AT_DATA([configure.ac],
 [[AC_INIT([GNU "String++"],
-	  [2.48], [http://clisp.cons.org/], [clisp])
+	  [2.48], [http://example.com/], [clisp])
 AC_OUTPUT
 ]])
 
@@ -259,7 +262,7 @@ AT_CHECK([grep 'AC_INIT: not a literal: ' stderr], [], [ignore])
 
 AT_DATA([configure.ac],
 [[AC_INIT([GNU String++],
-	  ['codename' 2.48], [http://clisp.cons.org/], [clisp])
+	  ['codename' 2.48], [http://example.com/], [clisp])
 AC_OUTPUT
 ]])
 
@@ -268,7 +271,7 @@ AT_CHECK([grep 'AC_INIT: not a literal: ' stderr], [], [ignore])
 
 AT_DATA([configure.ac],
 [[AC_INIT([GNU
-String++], [2.48], [http://clisp.cons.org/], [clisp])
+String++], [2.48], [http://example.com/], [clisp])
 AC_OUTPUT
 ]])
 
commit e0ac12089ea4c934029baf77741e659f0bebd653
Author: Eric Blake <eblake@redhat.com>
Date:   Wed Aug 25 16:21:39 2010 -0600

    m4sh: fix some namespace safety issues
    
    * lib/m4sugar/m4sh.m4 (_AS_SHELL_SANITIZE): Avoid problems if
    as_myself is inherited from environment.
    (AS_TMPDIR): Be namespace clean.
    
    Signed-off-by: Eric Blake <eblake@redhat.com>

diff --git a/lib/m4sugar/m4sh.m4 b/lib/m4sugar/m4sh.m4
index 3cc868c..15dd80d 100644
--- a/lib/m4sugar/m4sh.m4
+++ b/lib/m4sugar/m4sh.m4
@@ -425,6 +425,7 @@ _AS_PATH_SEPARATOR_PREPARE
 IFS=" ""	$as_nl"
 
 # Find who we are.  Look in the path if we contain no directory separator.
+as_myself=
 case $[0] in @%:@((
   *[[\\/]]* ) as_myself=$[0] ;;
   *) _AS_PATH_WALK([],
@@ -1618,12 +1619,13 @@ m4_define([AS_TMPDIR],
 [# Create a (secure) tmp directory for tmp files.
 m4_if([$2], [], [: ${TMPDIR=/tmp}])
 {
-  tmp=`(umask 077 && mktemp -d "m4_default([$2], [$TMPDIR])/$1XXXXXX") 2>/dev/null` &&
-  test -n "$tmp" && test -d "$tmp"
+  as_tmp=`(umask 077 && mktemp -d "m4_default([$2],
+    [$TMPDIR])/$1XXXXXX") 2>/dev/null` &&
+  test -d "$as_tmp"
 }  ||
 {
-  tmp=m4_default([$2], [$TMPDIR])/$1$$-$RANDOM
-  (umask 077 && mkdir "$tmp")
+  as_tmp=m4_default([$2], [$TMPDIR])/$1$$-$RANDOM
+  (umask 077 && mkdir "$as_tmp")
 } || AS_ERROR([cannot create a temporary directory in m4_default([$2],
 	      [$TMPDIR])])])# AS_TMPDIR
 

